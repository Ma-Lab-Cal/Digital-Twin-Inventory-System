<!DOCTYPE HTML>
<html>
<head>
  <script src="https://cdn.plot.ly/plotly-2.9.0.min.js"></script>
</head>
<body>
  <div id="plot">
  </div>

  <script>
    var env_data = [
      {
        x: [],
        y: [],
        mode: "lines",
        type: "scatter",
      },
      {
        x: [],
        y: [],
        mode: "lines",
        type: "scatter",
      },
    ];


    var ws = new WebSocket("ws://127.0.0.1:8000/ws");

    var requestData = function() {
      ws.send("hello");
    }

    ws.onopen = function () {
      console.log("Connection success");
    };

    ws.onmessage = function (e) {
      var data = e.data;
      data = JSON.parse(data);
      console.log("recv");
      console.log(data);

      env_data[0].x.push(data["/timestamp"]);
      env_data[0].y.push(data["/node0/temperature"]);
      env_data[1].x.push(data["/timestamp"]);
      env_data[1].y.push(data["/node1/temperature"]);

      env_data[0].x = env_data[0].x.slice(-600);
      env_data[0].y = env_data[0].y.slice(-600);
      env_data[1].x = env_data[1].x.slice(-600);
      env_data[1].y = env_data[1].y.slice(-600);

      Plotly.redraw('plot');
    };

    ws.onclose = function () {
      console.log("Connection is closed...");
    };

    setInterval(requestData, 5000);

  </script>
  <script>

    Plotly.newPlot("plot", env_data);
  </script>
</body>

</html>